{
  "my_pipeline": {
    "processors": [
      {
        "script": {
          "lang": "painless",
          "source": "String s = ctx.message; int idx = s.indexOf(','); int last = 0; while (idx > -1) { String kv = s.substring(last, idx); int eqidx = kv.indexOf('='); ctx[kv.substring(0,eqidx)] = kv.substring(eqidx+1); last = idx + 1; idx = s.indexOf(',', last); } String kv = s.substring(last); int eqidx = kv.indexOf('='); ctx[kv.substring(0,eqidx)] = kv.substring(eqidx+1);"

        }
      }
    ]
  }
}
